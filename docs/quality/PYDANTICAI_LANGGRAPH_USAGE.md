# üìä –ê–Ω–∞–ª—ñ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è PydanticAI —Ç–∞ LangGraph

**–î–∞—Ç–∞ –∞–Ω–∞–ª—ñ–∑—É:** 22.12.2025  
**–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å Python —Ñ–∞–π–ª—ñ–≤:** 164

---

## üîç –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### LangGraph
- **–§–∞–π–ª—ñ–≤ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º:** 25 —Ñ–∞–π–ª—ñ–≤
- **–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–≥–∞–¥–æ–∫:** 58
- **–í—ñ–¥—Å–æ—Ç–æ–∫ —Ñ–∞–π–ª—ñ–≤:** ~15.2% (25/164)

### PydanticAI
- **–§–∞–π–ª—ñ–≤ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º:** 4 —Ñ–∞–π–ª–∏
- **–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–≥–∞–¥–æ–∫:** 56
- **–í—ñ–¥—Å–æ—Ç–æ–∫ —Ñ–∞–π–ª—ñ–≤:** ~2.4% (4/164)

---

## üéØ –ö—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å –¥–ª—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ

### LangGraph: **~90% –∫—Ä–∏—Ç–∏—á–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ**

**–©–æ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ LangGraph:**
1. ‚úÖ **–í—Å—ñ –≤—Ö—ñ–¥–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –ø—Ä–æ—Ö–æ–¥—è—Ç—å —á–µ—Ä–µ–∑ LangGraph
   - `src/workers/tasks/messages.py` - –≥–æ–ª–æ–≤–Ω–∞ –∑–∞–¥–∞—á–∞
   - `src/services/conversation/handler.py` - –æ–±—Ä–æ–±–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
   - `src/bot/telegram_bot.py` - Telegram —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è
   - `src/server/routers/manychat.py` - ManyChat —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è

2. ‚úÖ **12+ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö nodes:**
   - `moderation_node` - –º–æ–¥–µ—Ä–∞—Ü—ñ—è
   - `intent_detection_node` - –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–º—ñ—Ä—É
   - `vision_node` - –æ–±—Ä–æ–±–∫–∞ —Ñ–æ—Ç–æ
   - `agent_node` - –≥–æ–ª–æ–≤–Ω–∏–π AI –∞–≥–µ–Ω—Ç
   - `offer_node` - —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó
   - `payment_node` - –æ–±—Ä–æ–±–∫–∞ –æ–ø–ª–∞—Ç–∏
   - `upsell_node` - –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–æ–¥–∞–∂—ñ
   - `validation_node` - –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
   - `escalation_node` - –µ—Å–∫–∞–ª–∞—Ü—ñ—è
   - `memory_node` - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ
   - `sitniks_status_node` - CRM —Å—Ç–∞—Ç—É—Å–∏
   - `crm_error_node` - –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ CRM

3. ‚úÖ **State management:**
   - `ConversationState` - —Å—Ç–∞–Ω —Ä–æ–∑–º–æ–≤–∏
   - PostgreSQL checkpointer - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å
   - Routing logic - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è

4. ‚úÖ **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è –≤—Å—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É:**
   - –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ñ–∞–∑–∏ –¥—ñ–∞–ª–æ–≥—É
   - –ü–µ—Ä–µ—Ö–æ–¥–∏ –º—ñ–∂ —Å—Ç–∞–Ω–∞–º–∏
   - Self-correction loops
   - Human-in-the-loop

**–©–æ –ù–ï –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ LangGraph:**
- API endpoints (FastAPI)
- Webhook debouncing
- Celery tasks (followups, summarization, CRM)
- Database services (Supabase)
- External integrations (ManyChat API, Telegram API)

---

### PydanticAI: **~70% AI —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ**

**–©–æ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ PydanticAI:**
1. ‚úÖ **4 AI –∞–≥–µ–Ω—Ç–∏:**
   - `main_agent.py` - –≥–æ–ª–æ–≤–Ω–∏–π –∞–≥–µ–Ω—Ç (–æ–±—Ä–æ–±–∫–∞ –∑–∞–ø–∏—Ç—ñ–≤, –ø–æ—à—É–∫ —Ç–æ–≤–∞—Ä—ñ–≤)
   - `vision_agent.py` - —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ñ–æ—Ç–æ
   - `payment_agent.py` - –æ–±—Ä–æ–±–∫–∞ –æ–ø–ª–∞—Ç–∏
   - `memory_agent.py` - –∞–Ω–∞–ª—ñ–∑ –ø–∞–º'—è—Ç—ñ

2. ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è AI –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π:**
   - –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (Pydantic models)
   - Type-safe output
   - Tool calling (search_catalog, check_stock)

3. ‚úÖ **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ LLM:**
   - OpenAI GPT-5.1 only (OpenRouter removed)
   - Model management
   - Provider abstraction

**–©–æ –ù–ï –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ PydanticAI:**
- –ú–æ–¥–µ—Ä–∞—Ü—ñ—è (OpenAI Moderation API –Ω–∞–ø—Ä—è–º—É)
- Intent detection (–º–æ–∂–µ –±—É—Ç–∏ –±–µ–∑ PydanticAI)
- Business logic (payment validation, catalog search)
- Memory storage (Supabase)
- CRM integration

---

## üìà –ó–∞–≥–∞–ª—å–Ω–∞ –æ—Ü—ñ–Ω–∫–∞

### –ó–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—é:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ö—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å | –í—ñ–¥—Å–æ—Ç–æ–∫ |
|-----------|-------------|----------|
| **LangGraph** | –ö—Ä–∏—Ç–∏—á–Ω–æ | **~90%** |
| **PydanticAI** | –ö—Ä–∏—Ç–∏—á–Ω–æ | **~70%** |
| **–†–∞–∑–æ–º** | –ö—Ä–∏—Ç–∏—á–Ω–æ | **~95%** |

### –ó–∞ –∫–æ–¥–æ–º:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª—ñ–≤ | –í—ñ–¥—Å–æ—Ç–æ–∫ |
|-----------|--------|----------|
| **LangGraph** | 25/164 | **15.2%** |
| **PydanticAI** | 4/164 | **2.4%** |
| **–†–∞–∑–æ–º** | 29/164 | **17.7%** |

---

## üéØ –í–∏—Å–Ω–æ–≤–∫–∏

### 1. **LangGraph - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (90%)**
- **–ö—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)
- **–†–æ–ª—å:** –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è –≤—Å—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- **–ë–µ–∑ –Ω—å–æ–≥–æ:** –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø–æ–≤–Ω–∞ –ø–µ—Ä–µ–±—É–¥–æ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

### 2. **PydanticAI - AI –ú–æ–∑–æ–∫ (70%)**
- **–ö—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)
- **–†–æ–ª—å:** –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è AI –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π output
- **–ë–µ–∑ –Ω—å–æ–≥–æ:** –ú–æ–∂–Ω–∞ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –ø—Ä—è–º—ñ –≤–∏–∫–ª–∏–∫–∏ OpenAI, –∞–ª–µ –≤—Ç—Ä–∞—Ç–∏—Ç—å—Å—è:
  - Type safety
  - –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
  - Tool calling
  - Provider abstraction

### 3. **–†–∞–∑–æ–º (95%)**
- **–ö—Ä–∏—Ç–∏—á–Ω—ñ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)
- **–†–æ–ª—å:** –û—Å–Ω–æ–≤–∞ –≤—Å—å–æ–≥–æ AI-—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É
- **–ë–µ–∑ –Ω–∏—Ö:** –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —è–∫ AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç

---

## üìù –î–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è

### –§–∞–π–ª–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å LangGraph:
1. `src/agents/langgraph/graph.py` - –≥–æ–ª–æ–≤–Ω–∏–π –≥—Ä–∞—Ñ
2. `src/agents/langgraph/nodes/*` - 12+ nodes
3. `src/services/conversation/handler.py` - –æ–±—Ä–æ–±–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
4. `src/workers/tasks/messages.py` - –≥–æ–ª–æ–≤–Ω–∞ –∑–∞–¥–∞—á–∞
5. `src/bot/telegram_bot.py` - Telegram —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è
6. `src/server/routers/*` - webhook handlers
7. `src/core/conversation_state.py` - state management
8. –Ü —â–µ 18 —Ñ–∞–π–ª—ñ–≤...

### –§–∞–π–ª–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å PydanticAI:
1. `src/agents/pydantic/main_agent.py` - –≥–æ–ª–æ–≤–Ω–∏–π –∞–≥–µ–Ω—Ç
2. `src/agents/pydantic/vision_agent.py` - —Ñ–æ—Ç–æ –∞–≥–µ–Ω—Ç
3. `src/agents/pydantic/payment_agent.py` - –æ–ø–ª–∞—Ç–∞ –∞–≥–µ–Ω—Ç
4. `src/agents/pydantic/memory_agent.py` - –ø–∞–º'—è—Ç—å –∞–≥–µ–Ω—Ç

---

## ‚ö†Ô∏è –†–∏–∑–∏–∫–∏

### –Ø–∫—â–æ LangGraph –∑–ª–∞–º–∞—î—Ç—å—Å—è:
- ‚ùå –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- ‚ùå –í—Ç—Ä–∞—á–∞—î—Ç—å—Å—è state management
- ‚ùå –í—Ç—Ä–∞—á–∞—î—Ç—å—Å—è routing logic
- ‚ùå –í—Ç—Ä–∞—á–∞—î—Ç—å—Å—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è

### –Ø–∫—â–æ PydanticAI –∑–ª–∞–º–∞—î—Ç—å—Å—è:
- ‚ùå –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ AI –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- ‚ùå –í—Ç—Ä–∞—á–∞—î—Ç—å—Å—è type safety
- ‚ùå –í—Ç—Ä–∞—á–∞—î—Ç—å—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π output
- ‚ö†Ô∏è –ú–æ–∂–Ω–∞ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –ø—Ä—è–º—ñ –≤–∏–∫–ª–∏–∫–∏ OpenAI (–∑ –≤—Ç—Ä–∞—Ç–æ—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ)

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

1. **LangGraph:** –ö—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–π - –ø–æ—Ç—Ä—ñ–±–µ–Ω –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ fallback
2. **PydanticAI:** –ö—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–π - –ø–æ—Ç—Ä—ñ–±–µ–Ω –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ fallback
3. **–í–µ—Ä—Å—ñ—ó:** –û–±–∏–¥–≤—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –º–∞—é—Ç—å –±—É—Ç–∏ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–º–∏ —Ç–∞ —Å—É–º—ñ—Å–Ω–∏–º–∏
4. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** –ü–æ—Ç—Ä—ñ–±–Ω—ñ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ –¥–ª—è –æ–±–æ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** –í–∞–∂–ª–∏–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏

---

**–í–∏—Å–Ω–æ–≤–æ–∫:** PydanticAI —Ç–∞ LangGraph - —Ü–µ **95% –∫—Ä–∏—Ç–∏—á–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ** —Å–∏—Å—Ç–µ–º–∏. –ë–µ–∑ –Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —è–∫ AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç.

