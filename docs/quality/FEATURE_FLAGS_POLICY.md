# Политика Feature Flags

**Дата:** 2025-12-23  
**Версия:** 1.0  
**Статус:** ACTIVE

---

## Принципы

### 1. Запрещены Temporary Flags без плана

**Правило:** Каждый temporary flag должен иметь:
- Документацию что он делает
- План миграции/удаления
- Expiry date или критерий удаления

**Исключения:**
- Feature flags для A/B тестирования (с четкими критериями)
- Опциональные функции (не temporary)

---

## Реестр Feature Flags

### ENABLE_LEGACY_STATE_ALIASES

**Файл:** `src/conf/config.py:192-195`  
**Использование:** `src/core/state_machine.py:488`

**Описание:**
Разрешает использование legacy названий состояний для обратной совместимости.

**Legacy aliases:**
- `STATE0_INIT` → `STATE_0_INIT`
- `STATE1_DISCOVERY` → `STATE_1_DISCOVERY`
- `STATE3_CLARIFY` → `STATE_3_SIZE_COLOR` (renamed)
- `STATE5_COMPARISON` → `STATE_5_PAYMENT_DELIVERY` (renamed)
- И т.д.

**Почему нужен:**
- Старые данные в БД могут содержать старые названия состояний
- Миграция данных может быть сложной
- Обратная совместимость важна для production

**План миграции:**
1. **Фаза 1 (текущая)**: Флаг ON по умолчанию, логируем использование legacy aliases
2. **Фаза 2 (через 3 месяца)**: Проверить метрики использования legacy aliases
3. **Фаза 3**: Если использование < 1% → миграция данных + удаление флага
4. **Фаза 4**: Если использование > 1% → оставить флаг, но убрать пометку "temporary"

**Решение:** 
Убрать пометку "temporary" и документировать как долгосрочную обратную совместимость. Флаг остается, но с четкой документацией.

**Expiry:** Нет (долгосрочная обратная совместимость)

---

## Правила для новых флагов

1. **Обязательна документация:** Что делает флаг, почему нужен
2. **Обязателен план:** Миграция или удаление
3. **Обязателен expiry:** Дата или критерий удаления
4. **Обязательны метрики:** Отслеживание использования флага

---

## Следующие шаги

1. ✅ Документация создана
2. ⏭️ Убрать пометку "temporary" из ENABLE_LEGACY_STATE_ALIASES
3. ⏭️ Добавить метрики использования legacy aliases
4. ⏭️ Проверить другие temporary флаги (если есть)

