{
  "version": "1.0.0",
  "project": "MIRT-child-clothes",
  "type": "supabase_integration",
  "description": "Тести інтеграції з Supabase: embeddings, пошук, RPC",
  "tests": [
    {
      "id": "SB-001",
      "description": "Семантичний пошук — сукня святкова",
      "type": "semantic_search",
      "input": {
        "query": "сукня святкова на день народження",
        "match_count": 5
      },
      "expected": {
        "min_results": 1,
        "max_results": 5,
        "must_have_fields": ["id", "name", "colors", "photo_url"],
        "relevance_keywords": ["сукня", "святков"],
        "similarity_threshold": 0.3
      }
    },
    {
      "id": "SB-002",
      "description": "Семантичний пошук — костюм зі штанами",
      "type": "semantic_search",
      "input": {
        "query": "костюм для хлопчика зі штанами",
        "match_count": 5
      },
      "expected": {
        "min_results": 1,
        "max_results": 5,
        "must_have_fields": ["id", "name"],
        "relevance_keywords": ["костюм", "штан"],
        "similarity_threshold": 0.3
      }
    },
    {
      "id": "SB-003",
      "description": "Пошук за ID продукту",
      "type": "get_by_id",
      "input": {
        "product_id": "3443041"
      },
      "expected": {
        "must_exist": true,
        "must_have_fields": ["id", "name", "colors", "sizes"],
        "expected_name_contains": "Сукня Анна"
      }
    },
    {
      "id": "SB-004",
      "description": "Пошук неіснуючого ID",
      "type": "get_by_id",
      "input": {
        "product_id": "9999999999"
      },
      "expected": {
        "must_exist": false,
        "should_return_empty": true
      }
    },
    {
      "id": "SB-005",
      "description": "RPC match_mirt_products працює",
      "type": "rpc_call",
      "input": {
        "rpc_name": "match_mirt_products",
        "params": {
          "match_count": 3
        }
      },
      "expected": {
        "must_succeed": true,
        "min_results": 1
      }
    },
    {
      "id": "SB-006",
      "description": "Сесія — створення та читання",
      "type": "session_crud",
      "input": {
        "session_id": "test-session-supabase-001",
        "action": "create_read"
      },
      "expected": {
        "create_success": true,
        "read_success": true,
        "data_matches": true
      }
    },
    {
      "id": "SB-007",
      "description": "Embeddings — перевірка розмірності вектора",
      "type": "embedding_check",
      "input": {
        "product_id": "3443041"
      },
      "expected": {
        "embedding_exists": true,
        "embedding_dim": 1536,
        "chunk_text_not_empty": true
      }
    },
    {
      "id": "SB-008",
      "description": "Пошук з порожнім запитом",
      "type": "semantic_search",
      "input": {
        "query": "",
        "match_count": 5
      },
      "expected": {
        "should_return_empty": true,
        "no_error": true
      }
    },
    {
      "id": "SB-009",
      "description": "Пошук з SQL injection спробою",
      "type": "semantic_search",
      "input": {
        "query": "'; DROP TABLE mirt_products; --",
        "match_count": 5
      },
      "expected": {
        "no_error": true,
        "table_still_exists": true,
        "should_return_empty": true
      }
    },
    {
      "id": "SB-010",
      "description": "Перевірка photo_url в colors",
      "type": "check_photo_extraction",
      "input": {
        "product_id": "3443041"
      },
      "expected": {
        "photo_url_extracted": true,
        "photo_url_valid_format": true,
        "url_starts_with": "https://"
      }
    },
    {
      "id": "SB-011",
      "description": "Пошук тренча",
      "type": "semantic_search",
      "input": {
        "query": "тренч екошкіра для дівчинки",
        "match_count": 3
      },
      "expected": {
        "min_results": 1,
        "relevance_keywords": ["тренч", "екошкір"],
        "similarity_threshold": 0.3
      }
    },
    {
      "id": "SB-012",
      "description": "Перевірка всіх обов'язкових полів продукту",
      "type": "schema_validation",
      "input": {
        "table": "mirt_products",
        "sample_size": 5
      },
      "expected": {
        "required_fields": ["id", "name", "category", "colors"],
        "all_records_valid": true
      }
    }
  ]
}
